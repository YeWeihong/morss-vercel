# Morss 部署指南

> **版权声明**  
> 本项目基于 [pictuga/morss](https://git.pictuga.com/pictuga/morss) 原创项目进行修改。  
> 原作者：pictuga  
> 原项目许可证：GNU AGPLv3  
> 本 fork 仓库：[YeWeihong/morss](https://github.com/YeWeihong/morss)  
> 
> 感谢原作者 pictuga 创建了这个优秀的 RSS 全文抓取工具。本文档基于原项目 README 的部署方式编写，结合本 fork 的修改内容提供中文部署说明。

> **快速参考**：如果你只需要快速命令参考，请查看 **[快速部署.md](快速部署.md)**

## 目录

- [快速开始](#快速开始)
- [Docker 部署（推荐）](#docker-部署推荐)
- [Python 包安装](#python-包安装)
- [运行 Morss](#运行-morss)
- [云服务部署](#云服务部署)
- [高级配置](#高级配置)
- [系统服务配置](#系统服务配置)
- [常见问题](#常见问题)

## 快速开始

Morss 支持多种部署方式，最简单的方式是使用 Docker。如果你想快速体验：

```bash
# 使用 Docker 快速启动（推荐）
docker run -p 8000:8000 pictuga/morss

# 访问服务
# 浏览器打开：http://localhost:8000
```

## Docker 部署（推荐）

Docker 是最简单、最可靠的部署方式，适合生产环境使用。

### 方式一：使用官方镜像

#### 运行容器

```bash
# 基本运行
docker run -p 8000:8000 pictuga/morss

# 后台运行，并设置环境变量
docker run -d \
  --name morss \
  -p 8000:8000 \
  -e DEBUG=1 \
  -e CACHE=diskcache \
  -e CACHE_SIZE=1073741824 \
  pictuga/morss

# 使用磁盘缓存并持久化
docker run -d \
  --name morss \
  -p 8000:8000 \
  -e CACHE=diskcache \
  -e DISKCACHE_DIR=/cache \
  -v /path/on/host/morss-cache:/cache \
  pictuga/morss
```

#### 使用 Docker Compose（推荐）

创建 `docker-compose.yml` 文件：

```yaml
version: '3.8'

services:
  morss:
    image: pictuga/morss
    container_name: morss
    ports:
      - "8000:8000"
    environment:
      # 调试模式（生产环境建议关闭）
      - DEBUG=0
      # 缓存配置
      - CACHE=diskcache
      - CACHE_SIZE=1073741824  # 1GB
      - DISKCACHE_DIR=/cache
      # 性能配置
      - MAX_ITEM=100
      - MAX_TIME=60
      - TIMEOUT=15
      # Gunicorn 配置
      - GUNICORN_CMD_ARGS=--workers=4 --timeout=120
    volumes:
      # 持久化缓存
      - ./morss-cache:/cache
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "/bin/sh", "/app/morss-helper", "check"]
      interval: 30s
      timeout: 10s
      retries: 3
```

启动服务：

```bash
# 启动服务
docker-compose up -d

# 查看日志
docker-compose logs -f

# 停止服务
docker-compose down

# 重新构建并启动
docker-compose up -d --build
```

### 方式二：从源码构建

如果你想使用本 fork 项目的代码（包含额外的中文文档和改进）：

#### 命令行方式

```bash
# 克隆本仓库
git clone https://github.com/YeWeihong/morss.git
cd morss

# 构建镜像
docker build -t morss:custom .

# 运行
docker run -d -p 8000:8000 --name morss morss:custom
```

#### Docker Compose 方式

创建 `docker-compose.yml` 文件：

```yaml
version: '3.8'

services:
  morss:
    build: .
    image: morss:custom
    container_name: morss-custom
    ports:
      - "8000:8000"
    environment:
      - DEBUG=0
      - CACHE=diskcache
      - CACHE_SIZE=1073741824
      - DISKCACHE_DIR=/cache
    volumes:
      - ./morss-cache:/cache
    restart: unless-stopped
```

启动：

```bash
docker-compose build
docker-compose up -d
```

### 使用 Redis 缓存（可选）

如果需要更好的缓存性能，可以使用 Redis：

```yaml
version: '3.8'

services:
  morss:
    image: pictuga/morss
    container_name: morss
    ports:
      - "8000:8000"
    environment:
      - CACHE=redis
      - REDIS_HOST=redis
      - REDIS_PORT=6379
      - REDIS_DB=0
    depends_on:
      - redis
    restart: unless-stopped

  redis:
    image: redis:alpine
    container_name: morss-redis
    volumes:
      - ./redis-data:/data
    restart: unless-stopped
```

## Python 包安装

适合需要将 Morss 集成到其他 Python 项目，或者需要自定义修改的场景。

### 系统要求

- Python 3.7 或更高版本（也支持 Python 2.7+，但建议使用 Python 3）
- pip 包管理器
- gcc 和其他编译工具（用于编译 lxml）

### 安装依赖（可选但推荐）

在某些系统上，使用系统包管理器安装 lxml 会更快：

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install python3-lxml python3-pip

# CentOS/RHEL
sudo yum install python3-lxml python3-pip

# macOS (使用 Homebrew)
brew install python libxml2 libxslt
pip3 install lxml

# Arch Linux
sudo pacman -S python-lxml
```

### 安装方式

#### 方式一：从 PyPI 安装（稳定版）

```bash
# 基本安装（仅核心依赖）
pip install morss

# 完整安装（包含所有可选依赖，推荐）
pip install morss[full]
```

#### 方式二：从原项目 Git 安装

```bash
# 基本安装
pip install git+https://git.pictuga.com/pictuga/morss.git

# 完整安装
pip install 'git+https://git.pictuga.com/pictuga/morss.git#egg=morss[full]'
```

#### 方式三：从本 fork 项目安装

如果你想使用本 fork 项目的改进（包含中文文档和额外功能）：

```bash
# 克隆仓库
git clone https://github.com/YeWeihong/morss.git
cd morss

# 安装到系统
pip install .[full]

# 或者使用开发模式（方便修改代码）
pip install -e .[full]
```

### 依赖说明

#### 核心依赖（必需）
- `lxml` - XML/HTML 解析
- `bs4` (BeautifulSoup4) - HTML 解析辅助
- `python-dateutil` - 日期时间处理
- `chardet` - 字符编码检测

#### 可选依赖（推荐安装）
- `redis` - Redis 缓存支持
- `diskcache` - 磁盘缓存支持
- `gunicorn` - 高性能 HTTP 服务器
- `setproctitle` - 进程标题设置

## 运行 Morss

Morss 支持多种运行模式，会自动检测合适的运行方式。

### 作为 Web 服务器运行

#### 使用内置 HTTP 服务器（开发/测试）

```bash
# 默认在 8000 端口启动
morss

# 自定义端口
PORT=9000 morss

# 启用调试模式
DEBUG=1 morss
```

访问：`http://localhost:8000`

**注意**：内置 HTTP 服务器性能有限，仅适合开发测试，生产环境请使用 Gunicorn 或 uWSGI。

#### 使用 Gunicorn（推荐用于生产）

```bash
# 基本启动
gunicorn --preload morss

# 自定义配置
gunicorn --preload \
  --bind 0.0.0.0:8000 \
  --workers 4 \
  --timeout 120 \
  --access-logfile - \
  --error-logfile - \
  morss

# 使用环境变量配置
GUNICORN_CMD_ARGS="--workers=4 --timeout=120" gunicorn --preload morss
```

#### 使用 uWSGI

```bash
# 基本启动
uwsgi --http :8000 --plugin python --wsgi-file main.py

# 使用配置文件
uwsgi --ini uwsgi.ini
```

创建 `uwsgi.ini` 配置文件：

```ini
[uwsgi]
http = :8000
wsgi-file = main.py
master = true
processes = 4
threads = 2
vacuum = true
die-on-term = true
```

#### 使用 Apache mod_cgi/FastCGI

需要配置 `.htaccess` 文件（项目中已包含示例）：

```htaccess
Options -Indexes

ErrorDocument 404 /cgi/main.py

# 开启所有请求的调试
SetEnv DEBUG 1

# 仅对包含 :debug 的 URL 开启调试
SetEnvIf Request_URI :debug DEBUG=1

<Files ~ "\.(py|pyc|db|log)$">
    deny from all
</Files>

<Files main.py>
    allow from all
    AddHandler cgi-script .py
    Options +ExecCGI
</Files>
```

### 作为命令行工具使用

```bash
# 基本用法
morss http://feeds.bbci.co.uk/news/rss.xml

# 获取完整文章内容
morss --clip http://feeds.bbci.co.uk/news/rss.xml

# 输出为 JSON 格式
morss --format json http://feeds.bbci.co.uk/news/rss.xml

# 输出为 CSV 格式
morss --format csv http://feeds.bbci.co.uk/news/rss.xml

# 使用缓存
morss --cache http://feeds.bbci.co.uk/news/rss.xml

# 强制刷新
morss --force http://feeds.bbci.co.uk/news/rss.xml
```

在 Docker 中使用命令行：

```bash
docker run --rm pictuga/morss morss --clip http://feeds.bbci.co.uk/news/rss.xml
```

### 作为 Newsreader 钩子（Liferea）

在 Liferea 的订阅源设置中启用"(Unix) command"，使用以下命令：

```bash
morss http://feeds.bbci.co.uk/news/rss.xml
```

### 作为 Python 库使用

```python
import morss

# 快速使用
xml_string = morss.process('http://feeds.bbci.co.uk/news/rss.xml')
print(xml_string[:100])

# 使用缓存和参数
url = 'http://feeds.bbci.co.uk/news/rss.xml'
cache = '/tmp/morss-cache'  # 磁盘缓存位置
options = {'csv': True}
result = morss.process(url, cache, options)

# 分步处理（更细粒度控制）
url = 'http://newspaper.example/feed.xml'
options = morss.Options(clip=True, format='json')

# 获取 RSS 订阅源
url, rss = morss.FeedFetch(url, options)

# 填充完整内容
rss = morss.FeedGather(rss, url, options)

# 格式化输出
output = morss.FeedFormat(rss, options, 'unicode')
print(output)
```

### URL 访问格式

当作为 Web 服务器运行时，使用以下 URL 格式访问：

```
http://服务器地址:端口/[main.py/][:参数1[:参数2=值[...]]]/订阅源URL
```

示例：

```bash
# 基本使用
http://localhost:8000/https://feeds.bbci.co.uk/news/rss.xml

# 使用 clip 参数
http://localhost:8000/:clip/https://feeds.bbci.co.uk/news/rss.xml

# 多个参数
http://localhost:8000/:clip:format=json/https://feeds.bbci.co.uk/news/rss.xml

# 自定义 XPath（| 在 URL 中代表 /）
http://localhost:8000/:items=|html|body|div/https://example.com
```

## 云服务部署

### Vercel（推荐用于快速部署）

Vercel 是一个现代化的无服务器部署平台，非常适合快速部署 Morss。

#### 一键部署

点击下方按钮即可部署到 Vercel：

[![Deploy with Vercel](https://vercel.com/button)](https://vercel.com/new/clone?repository-url=https://github.com/YeWeihong/morss)

#### 手动部署

**方式一：使用 Vercel CLI**

```bash
# 安装 Vercel CLI
npm i -g vercel

# 在项目目录中运行
cd morss
vercel

# 按照提示完成部署
# 首次部署会询问项目设置，直接回车使用默认值即可
```

**方式二：从 GitHub 导入**

1. 访问 [Vercel Dashboard](https://vercel.com/dashboard)
2. 点击 "New Project"
3. 从 GitHub 导入 `YeWeihong/morss` 仓库
4. Vercel 会自动检测配置并开始部署
5. 部署完成后会获得一个 `*.vercel.app` 域名

#### 环境变量配置（可选）

在 Vercel 项目设置中可以配置以下环境变量：

```bash
# 性能配置（Vercel serverless 有执行时间限制）
# 以下默认值已在 vercel.json 中配置
MAX_ITEM=30               # 限制抓取文章数（默认 30）
MAX_TIME=20               # 限制抓取时间（秒，默认 20）
TIMEOUT=8                 # HTTP 超时（秒，默认 8）
LIM_TIME=25               # 总时间限制（秒，默认 25）
LIM_ITEM=50               # 总条目限制（默认 50）

# 调试模式
DEBUG=0                   # 生产环境建议关闭
```

**缓存配置（可选）**：

默认情况下，Morss 使用内存缓存（每次请求独立）。如果需要持久化缓存：

```bash
# 使用外部 Redis（推荐，需要在 requirements.txt 中添加 redis 依赖）
CACHE=redis
REDIS_HOST=your-redis-host.upstash.io
REDIS_PORT=6379
REDIS_PWD=your-redis-password
REDIS_DB=0
```

**注意**：
- 磁盘缓存（`diskcache`）在 Vercel serverless 环境中**不起作用**
- 如需使用 Redis，需要手动添加 `redis` 依赖到 `requirements.txt`

#### 重要提示

由于 Vercel 的 serverless 函数有一些限制，需要注意：

1. **执行时间限制**：
   - Hobby 计划：10 秒
   - Pro 计划：60 秒
   - Enterprise 计划：900 秒
   
   因此建议设置较小的 `MAX_TIME` 和 `MAX_ITEM` 值。

2. **存储限制**：
   - Vercel serverless 函数是无状态的
   - 每次请求都会重新初始化
   - 磁盘缓存（diskcache）**不起作用**，每次请求后会丢失
   - 默认使用内存缓存（每次请求独立）
   - 如需持久化缓存，建议使用外部 Redis 服务（需要手动添加依赖）

3. **内存限制**：
   - Hobby/Pro 计划：1024 MB
   - 处理大型 RSS 订阅源时可能会超出内存限制

4. **最佳实践**：
   - Vercel 适合轻量级使用和个人项目
   - 对于高流量或需要处理大型订阅源的场景，建议使用 Docker 或 VPS 部署
   - 可以配合外部 Redis 服务（如 [Upstash](https://upstash.com/)）提升性能

#### 使用外部 Redis（推荐用于生产环境）

配置环境变量：

```bash
CACHE=redis
REDIS_HOST=your-redis-host.upstash.io
REDIS_PORT=6379
REDIS_PWD=your-redis-password
REDIS_DB=0
```

推荐的 Redis 服务提供商：
- [Upstash](https://upstash.com/) - 专为 serverless 设计，免费套餐可用
- [Redis Labs](https://redis.com/) - 企业级 Redis 服务
- [Railway](https://railway.app/) - 简单易用，支持 Redis

### Heroku

一键部署到 Heroku：

[![Deploy to Heroku](https://www.herokucdn.com/deploy/button.svg)](https://heroku.com/deploy?template=https://github.com/YeWeihong/morss)

手动部署：

```bash
# 安装 Heroku CLI
# 访问：https://devcenter.heroku.com/articles/heroku-cli

# 登录
heroku login

# 创建应用
heroku create your-app-name

# 设置环境变量
heroku config:set CACHE=diskcache
heroku config:set CACHE_SIZE=1073741824
heroku config:set DEBUG=0

# 部署
git push heroku main

# 查看日志
heroku logs --tail
```

### Google Cloud Run

一键部署到 Google Cloud Run：

[![Deploy to Google Cloud](https://deploy.cloud.run/button.svg)](https://deploy.cloud.run/?git_repo=https://github.com/YeWeihong/morss.git)

手动部署：

```bash
# 安装 Google Cloud SDK
# 访问：https://cloud.google.com/sdk/docs/install

# 登录
gcloud auth login

# 设置项目
gcloud config set project YOUR_PROJECT_ID

# 构建容器
gcloud builds submit --tag gcr.io/YOUR_PROJECT_ID/morss

# 部署
gcloud run deploy morss \
  --image gcr.io/YOUR_PROJECT_ID/morss \
  --platform managed \
  --region asia-east1 \
  --allow-unauthenticated \
  --memory 512Mi
```

### AWS/Oracle Cloud Infrastructure (cloud-init)

使用 cloud-init 配置（基于 Ubuntu）：

```yaml
#cloud-config

packages:
  - python3-pip
  - python3-wheel
  - python3-lxml
  - python3-setproctitle
  - ca-certificates

write_files:
  - path: /etc/environment
    append: true
    content: |
      DEBUG=0
      CACHE=diskcache
      CACHE_SIZE=1073741824
      DISKCACHE_DIR=/var/cache/morss
  - path: /var/lib/cloud/scripts/per-boot/morss.sh
    permissions: '0744'
    content: |
      #!/bin/sh
      /usr/local/bin/morss-helper daemon

runcmd:
  - source /etc/environment
  - update-ca-certificates
  - iptables -I INPUT 6 -m state --state NEW -p tcp --dport ${PORT:-8000} -j ACCEPT
  - netfilter-persistent save
  - pip3 install morss[full]
  - mkdir -p /var/cache/morss
  - chown ubuntu:ubuntu /var/cache/morss
```

### 其他云平台

#### DigitalOcean App Platform

创建 `app.yaml`：

```yaml
name: morss
services:
  - name: web
    dockerfile_path: Dockerfile
    http_port: 8000
    instance_count: 1
    instance_size_slug: basic-xxs
    envs:
      - key: CACHE
        value: diskcache
      - key: CACHE_SIZE
        value: "1073741824"
```

#### Railway

直接从 GitHub 仓库部署，Railway 会自动检测 Dockerfile。

## 高级配置

### 环境变量

Morss 支持通过环境变量进行配置。

#### 通用配置

```bash
# 调试模式
DEBUG=1              # 开启调试输出

# 忽略 SSL 证书验证
IGNORE_SSL=1         # 访问自签名证书网站时使用

# 数据文件路径
DATA_PATH=/path/to/www  # 自定义 www 文件夹位置
```

#### 缓存配置

```bash
# 缓存类型
CACHE=diskcache      # 可选：不设置（内存）、redis、diskcache

# 磁盘缓存配置
DISKCACHE_DIR=/path/to/cache  # 缓存目录
CACHE_SIZE=1073741824         # 缓存大小（字节），1GB

# Redis 缓存配置
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_DB=0
REDIS_PWD=password

# 缓存生命周期
CACHE_LIFESPAN=60    # 缓存清理间隔（秒）
```

#### 性能配置

```bash
# HTTP 超时
TIMEOUT=15           # HTTP 请求超时（秒）
DELAY=0              # 浏览器缓存延迟（秒）

# 抓取限制
MAX_TIME=60          # 最大抓取时间（秒），-1 无限制
MAX_ITEM=100         # 最大抓取文章数，-1 无限制
LIM_TIME=-1          # 总处理时间限制（秒），-1 无限制
LIM_ITEM=-1          # 总检查文章数限制，-1 无限制
```

#### Gunicorn 配置

```bash
# 通过环境变量配置 Gunicorn
GUNICORN_CMD_ARGS="--workers=4 --timeout=120 --bind=0.0.0.0:8000"

# 或者直接在命令行使用
gunicorn --workers 4 --timeout 120 --bind 0.0.0.0:8000 morss
```

### 命令行参数

完整参数列表：

```bash
morss --help
```

常用参数：

```bash
# 输出格式
--format {rss,json,html,csv}  # 输出格式

# 操作模式
--clip           # 保留原始内容，追加完整文章
--cache          # 仅使用缓存，不抓取新内容
--force          # 强制刷新，忽略缓存
--proxy          # 代理模式，不填充文章内容
--resolve        # 解析跟踪链接为直接链接

# 内容处理
--xpath XPATH    # 手动指定文章内容的 XPath
--search STRING  # 在订阅源中搜索（区分大小写）
--indent         # 输出格式化的 XML/JSON

# 自定义订阅源
--items XPATH           # 必需：匹配所有条目的 XPath
--item_link XPATH       # 条目链接的 XPath
--item_title XPATH      # 条目标题的 XPath
--item_content XPATH    # 条目内容的 XPath
--item_time XPATH       # 条目时间的 XPath
--mode {xml,html,json}  # 解析模式

# 其他
--nolink         # 移除链接但保留链接文本
--noref          # 移除条目链接
--silent         # 不输出最终 RSS（调试用）
```

### 反向代理配置

#### Nginx

```nginx
server {
    listen 80;
    server_name morss.example.com;

    location / {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 增加超时时间（Morss 处理可能需要较长时间）
        proxy_read_timeout 300s;
        proxy_connect_timeout 75s;
    }
}
```

#### Apache

```apache
<VirtualHost *:80>
    ServerName morss.example.com

    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:8000/
    ProxyPassReverse / http://127.0.0.1:8000/
    
    # 增加超时时间
    ProxyTimeout 300
</VirtualHost>
```

### HTTPS/SSL 配置

使用 Let's Encrypt 免费证书（推荐）：

```bash
# 安装 Certbot
sudo apt-get install certbot python3-certbot-nginx

# 获取证书（Nginx）
sudo certbot --nginx -d morss.example.com

# 获取证书（Apache）
sudo certbot --apache -d morss.example.com

# 自动续期
sudo certbot renew --dry-run
```

## 系统服务配置

将 Morss 配置为系统服务，实现开机自启和进程管理。

### 使用 systemd（推荐）

项目中包含 `morss.service` 示例文件，可以直接使用或修改。

#### 创建服务文件

创建 `/etc/systemd/system/morss.service`：

```ini
[Unit]
Description=Morss - Full-text RSS feeds
After=network.target

[Service]
Type=simple
User=www-data
Group=www-data
WorkingDirectory=/opt/morss
Environment="PATH=/usr/local/bin:/usr/bin:/bin"
Environment="CACHE=diskcache"
Environment="DISKCACHE_DIR=/var/cache/morss"
Environment="CACHE_SIZE=1073741824"
Environment="DEBUG=0"
ExecStart=/usr/local/bin/gunicorn --preload --bind 0.0.0.0:8000 --workers 4 --timeout 120 morss
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

#### 启用服务

```bash
# 创建缓存目录
sudo mkdir -p /var/cache/morss
sudo chown www-data:www-data /var/cache/morss

# 重载 systemd
sudo systemctl daemon-reload

# 启用服务
sudo systemctl enable morss

# 启动服务
sudo systemctl start morss

# 查看状态
sudo systemctl status morss

# 查看日志
sudo journalctl -u morss -f
```

### 使用 Docker Compose + systemd

创建 `/etc/systemd/system/morss.service`：

```ini
[Unit]
Description=Morss Docker Compose Service
Requires=docker.service
After=docker.service

[Service]
Type=oneshot
RemainAfterExit=yes
WorkingDirectory=/opt/morss
ExecStart=/usr/local/bin/docker-compose up -d
ExecStop=/usr/local/bin/docker-compose down
ExecReload=/usr/local/bin/docker-compose restart

[Install]
WantedBy=multi-user.target
```

### 使用 supervisor

安装 supervisor：

```bash
sudo apt-get install supervisor
```

创建 `/etc/supervisor/conf.d/morss.conf`：

```ini
[program:morss]
command=/usr/local/bin/gunicorn --preload --bind 0.0.0.0:8000 --workers 4 --timeout 120 morss
directory=/opt/morss
user=www-data
autostart=true
autorestart=true
redirect_stderr=true
stdout_logfile=/var/log/supervisor/morss.log
environment=CACHE="diskcache",DISKCACHE_DIR="/var/cache/morss",CACHE_SIZE="1073741824"
```

启动：

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start morss
sudo supervisorctl status morss
```

## 常见问题

### 1. lxml 安装失败

**问题**：安装 morss 时，lxml 编译失败。

**解决方案**：

```bash
# Ubuntu/Debian
sudo apt-get install python3-dev libxml2-dev libxslt1-dev zlib1g-dev

# CentOS/RHEL
sudo yum install python3-devel libxml2-devel libxslt-devel

# 或直接使用系统包
sudo apt-get install python3-lxml
```

### 2. Docker 容器无法访问

**问题**：启动 Docker 容器后无法访问 8000 端口。

**解决方案**：

```bash
# 检查端口映射
docker ps

# 检查容器日志
docker logs morss

# 确保防火墙允许 8000 端口
sudo ufw allow 8000
```

### 3. 内存不足

**问题**：处理大型订阅源时内存溢出。

**解决方案**：

```bash
# 限制处理的文章数
export MAX_ITEM=50
export LIM_ITEM=100

# 使用磁盘缓存而不是内存缓存
export CACHE=diskcache

# 增加 Docker 内存限制
docker run -m 1g -p 8000:8000 pictuga/morss
```

### 4. 请求超时

**问题**：抓取某些网站时总是超时。

**解决方案**：

```bash
# 增加超时时间
export TIMEOUT=30

# 对于 Gunicorn，增加 worker 超时
GUNICORN_CMD_ARGS="--timeout=180" gunicorn morss

# 对于 Nginx 反向代理，增加超时
proxy_read_timeout 300s;
```

### 5. 某些网站无法抓取

**问题**：特定网站返回 403 或空内容。

**解决方案**：

- 网站可能有反爬虫机制，查看 [CRAWLER_ANTI_SCRAPING_CN.md](CRAWLER_ANTI_SCRAPING_CN.md)
- 尝试使用代理：`export HTTP_PROXY=http://proxy.example.com:8080`
- 使用自定义 XPath 规则
- 检查网站是否需要 JavaScript 渲染（Morss 不支持 JS 渲染）

### 6. XPath 选择器无法加载某些网页

**问题**：XPath 选择器工具显示 CORS 错误。

**解决方案**：

这是浏览器安全限制，无法通过配置解决。请使用浏览器开发者工具（F12）手动获取 XPath：

1. 按 F12 打开开发者工具
2. 点击"元素选择器"图标
3. 点击页面元素
4. 右键点击 HTML 代码 → Copy → Copy XPath

详细说明请查看 [XPATH_CUSTOM_FEEDS_CN.md](XPATH_CUSTOM_FEEDS_CN.md)

### 7. 缓存不持久化

**问题**：重启后缓存丢失。

**解决方案**：

使用磁盘缓存或 Redis：

```bash
# 磁盘缓存
export CACHE=diskcache
export DISKCACHE_DIR=/path/to/cache

# 或在 Docker 中挂载卷
docker run -v /host/path:/cache -e CACHE=diskcache -e DISKCACHE_DIR=/cache morss
```

### 8. 权限问题

**问题**：Docker 容器内文件权限错误。

**解决方案**：

```bash
# 检查宿主机目录权限
sudo chown -R 1000:1000 /path/to/cache

# 或使用当前用户 ID
docker run -u $(id -u):$(id -g) ...
```

## 本 Fork 项目的特色功能

相比原项目，本 fork 版本增加了以下改进：

1. **完善的中文文档**
   - 项目流程说明（项目流程说明.md）
   - XPath 自定义规则中文指南（XPATH_CUSTOM_FEEDS_CN.md）
   - 爬虫机制与反爬策略详解（CRAWLER_ANTI_SCRAPING_CN.md）
   - 本部署指南

2. **可视化 XPath 选择器工具**
   - 访问 `http://localhost:8000/xpath-selector.html`
   - 可视化生成 XPath 规则
   - 一键复制和测试

3. **更详细的实现说明**
   - 参见 IMPLEMENTATION_SUMMARY_CN.md

所有功能都保持与原项目兼容，可以无缝切换。

## 相关文档

- **[README.md](README.md)** - 项目主说明文档（英文）
- **[PROJECT_WORKFLOW.md](PROJECT_WORKFLOW.md)** - 项目架构与工作流程（英文）
- **[项目流程说明.md](项目流程说明.md)** - 项目架构与工作流程（中文）
- **[XPATH_CUSTOM_FEEDS.md](XPATH_CUSTOM_FEEDS.md)** - XPath 自定义规则详解（英文）
- **[XPATH_CUSTOM_FEEDS_CN.md](XPATH_CUSTOM_FEEDS_CN.md)** - XPath 自定义规则详解（中文）
- **[CRAWLER_ANTI_SCRAPING_CN.md](CRAWLER_ANTI_SCRAPING_CN.md)** - 爬虫机制与反爬策略（中文）
- **[IMPLEMENTATION_SUMMARY_CN.md](IMPLEMENTATION_SUMMARY_CN.md)** - 功能实现说明（中文）

## 获取帮助

- **原项目主页**：https://morss.it/
- **原项目源码**：https://git.pictuga.com/pictuga/morss
- **原项目 GitHub 镜像**：https://github.com/pictuga/morss
- **本 Fork 项目**：https://github.com/YeWeihong/morss

## 许可证

本项目继承原项目的 GNU AGPLv3 许可证。

---

**再次感谢原作者 pictuga 的杰出工作！** 本文档基于原项目文档编写，旨在为中文用户提供更便捷的部署指南。
